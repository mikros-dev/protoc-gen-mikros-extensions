package addon

import (
	"embed"

	"github.com/rsfreitas/protoc-gen-mikros-extensions/pkg/settings"
	"github.com/rsfreitas/protoc-gen-mikros-extensions/pkg/template"
)

// Addon is an interface that a supported plugin addon must implement.
type Addon interface {
	// Name sets the addon name.
	Name() string

	// Templates must return all template files that the plugin handle.
	Templates() embed.FS

	// Kind returns the type of templates generated by the addon.
	Kind() template.Kind

	// GetTemplateImports should return a slice of all required imports for a
	// specific addon template.
	GetTemplateImports(name template.Name, ctx interface{}, cfg *settings.Settings) []*Import

	// GetContext should return a structure that will be available to be used
	// or accessed inside addons templates.
	GetContext(ctx interface{}) interface{}

	// Validator is the template package validator system that the plugin
	// must also implement.
	template.Validator
}

// OutboundExtension is an interface that allows the addon insert custom code
// into the outbound templates.
type OutboundExtension interface {
	// IntoOutbound is a function that must return a block of code that will
	// be inserted inside the IntoOutbound method generated by the plugin.
	// Here, the addon can manipulate specific fields and execute custom code
	// during the conversion.
	IntoOutbound(msg interface{}, receiver string) string
}

type Import struct {
	Alias string
	Name  string
}
